---
import {getCollection} from "astro:content";

import Layout from "../../layouts/Layout.astro";
import sanitizeHtml from 'sanitize-html';
import MarkdownIt from 'markdown-it';
const parser = new MarkdownIt();

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
    const postEntries = await getCollection("post");
    return postEntries.map((entry) => ({
        params: {slug: entry.slug},
        props: {entry},
    }));
}

// 2. For your template, you can get the entry directly from the prop
const {entry} = Astro.props;
const {Content} = await entry.render();


const content = sanitizeHtml(parser.render(entry.body), {
    allowedTags: []
});
---

<style>
    article :global(*) {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
    }

    article :global(h2) {
        font-size: 26px;
        @apply mt-8 font-semibold;

    }

    article :global(p) {
        font-size: 16px;
        line-height: 26px;
        margin-top: 20px;
        @apply sm:px-8;
    }

    article :global(img) {
        @apply rounded-3xl w-full mx-auto my-10;
    }

</style>


<Layout title={entry.data.title} description={`Napsal: ${entry.data.author}, ${entry.data.publishedAt.toLocaleDateString("cs-cz")}. ${content.substring(0, 130)}...`} canonical={"https://mladafrontavcera.cz/posts/" + entry.slug + "/"} image={entry.data.image}>
    <meta slot="head" name="googlebot-news" content="all">
    <script slot="head" type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "headline": entry.data.title,
        "image": [
            entry.data.image.src
        ],
        "datePublished": entry.data.publishedAt.toISOString(),
        "dateModified": entry.data.publishedAt.toISOString(),
        "author": [
            {
                "@type": "Person",
                "name": entry.data.author
            }
        ]
    })}/>
    <div class="max-w-3xl mx-auto">
        <h1 class="text-5xl font-medium tracking-tight" id="article--title">{entry.data.title}</h1>
        <div class="mt-2">
            Napsal: {entry.data.author}, {entry.data.publishedAt.toLocaleDateString("cs-cz")}
        </div>
        <hr class="mt-4"/>

        <article class="mt-4">
            <Content/>
        </article>
    </div>
</Layout>
